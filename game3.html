<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game 3 - Spell Telugu Words</title>
  <style>
    #letters, #answer {
      display: flex;
      justify-content: center;
      margin: 20px;
      gap: 10px;
      flex-wrap: wrap;
    }
    .letter {
      padding: 15px 20px;
      background-color: #5e17eb;
      color: white;
      font-size: 24px;
      border-radius: 8px;
      cursor: grab;
      user-select: none;
    }
    #answer {
      min-height: 50px;
      border: 2px dashed #ccc;
      padding: 10px;
      background: #f0f0f0;
      border-radius: 8px;
      min-width: 250px;
      flex-wrap: wrap;
    }
    #result {
      text-align: center;
      font-size: 18px;
      margin-top: 20px;
      min-height: 24px;
    }
    button {
      margin: 10px 5px;
      padding: 10px 15px;
      font-size: 16px;
      background: #f05454;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #controls {
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h2>Game 3: Spell the Telugu Word</h2>

  <div id="quiz-container">
    <p id="wordPrompt" style="text-align:center; font-size:20px; font-weight:bold;"></p>

    <div id="letters"></div>
    <div id="answer" ondragover="allowDrop(event)" ondrop="drop(event)"></div>

    <div id="controls">
      <button id="checkBtn" onclick="checkSpelling()">Check Spelling</button>
      <button onclick="resetGame()">Reset</button>
      <button onclick="prevWord()">‚¨ÖÔ∏è Previous</button>
      <button onclick="nextWord()">Next ‚û°Ô∏è</button>
    </div>

    <p id="result"></p>

    <audio id="wordAudio"></audio>
    <button onclick="playAudio()">üîä Hear Word</button>

    <p id="score" style="font-weight:bold; text-align:center; margin-top:15px;"></p>
  </div>

<script>
  const words = [
    {
      word: "‡∞™‡∞ø‡∞≤‡±ç‡∞≤‡∞ø",
      audio: "audio/pilli.mp3",
      letters: ["‡∞™‡∞ø", "‡∞≤", "‡±ç‡∞≤‡∞ø"]
    },
    {
      word: "‡∞ï‡±Å‡∞ï‡±ç‡∞ï",
      audio: "audio/kukka.mp3",
      letters: ["‡∞ï‡±Å", "‡∞ï‡±ç‡∞ï"]
    },
    {
      word: "‡∞ö‡±Ü‡∞ü‡±ç‡∞ü‡±Å",
      audio: "audio/chettu.mp3",
      letters: ["‡∞ö‡±Ü", "‡∞ü‡±ç‡∞ü‡±Å"]
    },
    {
      word: "‡∞™‡∞æ‡∞Æ‡±Å",
      audio: "audio/pamu.mp3",
      letters: ["‡∞™‡∞æ", "‡∞Æ‡±Å"]
    },
    {
      word: "‡∞µ‡±Ü‡∞≤‡±Å‡∞ó‡±Å",
      audio: "audio/velugu.mp3",
      letters: ["‡∞µ‡±Ü", "‡∞≤‡±Å", "‡∞ó‡±Å"]
    }
  ];

  let currentIndex = 0;
  let score = 0;
  let answeredCorrectly = false;

  const wordPrompt = document.getElementById('wordPrompt');
  const lettersDiv = document.getElementById('letters');
  const answerDiv = document.getElementById('answer');
  const resultEl = document.getElementById('result');
  const wordAudio = document.getElementById('wordAudio');
  const scoreEl = document.getElementById('score');
  const checkBtn = document.getElementById('checkBtn');

  function loadWord() {
    const current = words[currentIndex];
    wordPrompt.textContent = `Spell the word: "${current.word}"`;
    wordAudio.src = current.audio;

    // Clear letters and answer areas
    lettersDiv.innerHTML = '';
    answerDiv.innerHTML = '';
    resultEl.textContent = '';
    answeredCorrectly = false;
    checkBtn.disabled = false;

    // Shuffle letters so user can't guess order
    const shuffledLetters = shuffleArray([...current.letters]);
    shuffledLetters.forEach((letter, i) => {
      const letterDiv = document.createElement('div');
      letterDiv.textContent = letter;
      letterDiv.className = 'letter';
      letterDiv.setAttribute('draggable', 'true');
      letterDiv.id = `letter${i}`;
      letterDiv.addEventListener('dragstart', dragStart);
      lettersDiv.appendChild(letterDiv);
    });

    updateScore();
  }

  function shuffleArray(array) {
    for(let i = array.length -1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i+1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // Drag & Drop Handlers
  let dragged = null;

  function dragStart(e) {
    dragged = e.target;
  }

  function allowDrop(e) {
    e.preventDefault();
  }

  function drop(e) {
    e.preventDefault();
    if(dragged) {
      if(e.target.classList.contains('letter')) return;
      if(e.target.id === 'answer' || e.target.id === 'letters') {
        e.target.appendChild(dragged);
      } else {
        e.target.parentNode.appendChild(dragged);
      }
      dragged = null;
    }
  }

  function checkSpelling() {
    if (answeredCorrectly) return; // prevent multiple scoring

    let spelledWord = '';
    answerDiv.childNodes.forEach(node => {
      spelledWord += node.textContent.trim();
    });

    const normalizeText = (text) => text.normalize('NFC').trim();
    const userAnswer = normalizeText(spelledWord);
    const correctAnswer = normalizeText(words[currentIndex].word);

    if (userAnswer === correctAnswer) {
      resultEl.textContent = '‚úÖ Correct!';
      score++;
      updateScore();
      answeredCorrectly = true;
      checkBtn.disabled = true;
    } else {
      resultEl.textContent = '‚ùå Incorrect, try again!';
    }
  }

  function resetGame() {
    while(answerDiv.firstChild) {
      lettersDiv.appendChild(answerDiv.firstChild);
    }
    resultEl.textContent = '';
    answeredCorrectly = false;
    checkBtn.disabled = false;
  }

  function nextWord() {
    if(currentIndex < words.length - 1) {
      currentIndex++;
      resetGame();
      loadWord();
    }
  }

  function prevWord() {
    if(currentIndex > 0) {
      currentIndex--;
      resetGame();
      loadWord();
    }
  }

  function updateScore() {
    scoreEl.textContent = `Score: ${score} / ${words.length}`;
  }

  function playAudio() {
    wordAudio.play();
  }

  // Initialize game on load
  loadWord();

</script>
</body>
</html>
