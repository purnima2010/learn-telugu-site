<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game 3 - Spell Telugu Words</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 20px auto;
      text-align: center;
    }
    #letters, #answer {
      display: flex;
      justify-content: center;
      margin: 20px auto;
      gap: 10px;
      flex-wrap: wrap;
      min-height: 50px;
      border-radius: 8px;
    }
    #letters {
      border: 2px solid #6a5acd;
      padding: 10px;
      background: #e6e6fa;
      min-width: 300px;
    }
    #answer {
      border: 2px dashed #999;
      background: #fafafa;
      min-width: 300px;
      cursor: default;
    }
    .letter {
      padding: 12px 18px;
      background-color: #5e17eb;
      color: white;
      font-size: 28px;
      border-radius: 8px;
      cursor: grab;
      user-select: none;
      user-drag: element;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      transition: background-color 0.3s ease;
    }
    .letter:active {
      cursor: grabbing;
      background-color: #3b0d9b;
    }
    #result {
      font-weight: bold;
      font-size: 22px;
      margin-top: 20px;
      min-height: 28px;
    }
    #controls button {
      margin: 12px 8px;
      padding: 10px 18px;
      font-size: 16px;
      background: #f05454;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    #controls button:disabled {
      background-color: #d99;
      cursor: not-allowed;
    }
    #score {
      font-weight: bold;
      font-size: 20px;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <h2>Game 3: Spell the Telugu Word</h2>

  <p id="wordPrompt" style="font-size: 22px; font-weight: bold;"></p>

  <div id="letters" aria-label="Letter pieces, drag these to form the word"></div>
  <div id="answer" aria-label="Drop letters here to spell the word" ondragover="allowDrop(event)" ondrop="drop(event)"></div>

  <div id="controls">
    <button id="checkBtn" onclick="checkSpelling()">Check Spelling</button>
    <button onclick="resetGame()">Reset</button>
    <button onclick="prevWord()">‚¨ÖÔ∏è Previous</button>
    <button onclick="nextWord()">Next ‚û°Ô∏è</button>
  </div>

  <p id="result" aria-live="polite"></p>

  <audio id="wordAudio" preload="auto"></audio>
  <button onclick="playAudio()">üîä Hear Word</button>

  <p id="score"></p>

<script>
  const words = [
    {
      word: "‡∞™‡∞ø‡∞≤‡±ç‡∞≤‡∞ø",
      audio: "audio/pilli.mp3",
      letters: ["‡∞™‡∞ø", "‡∞≤", "‡±ç‡∞≤‡∞ø"]
    },
    {
      word: "‡∞ï‡±Å‡∞ï‡±ç‡∞ï",
      audio: "audio/kukka.mp3",
      letters: ["‡∞ï‡±Å", "‡∞ï‡±ç‡∞ï"]
    },
    {
      word: "‡∞ö‡±Ü‡∞ü‡±ç‡∞ü‡±Å",
      audio: "audio/chettu.mp3",
      letters: ["‡∞ö‡±Ü", "‡∞ü‡±ç‡∞ü‡±Å"]
    },
    {
      word: "‡∞™‡∞æ‡∞Æ‡±Å",
      audio: "audio/pamu.mp3",
      letters: ["‡∞™‡∞æ", "‡∞Æ‡±Å"]
    },
    {
      word: "‡∞µ‡±Ü‡∞≤‡±Å‡∞ó‡±Å",
      audio: "audio/velugu.mp3",
      letters: ["‡∞µ‡±Ü", "‡∞≤‡±Å", "‡∞ó‡±Å"]
    }
  ];

  let currentIndex = 0;
  let score = 0;
  let answeredCorrectly = false;

  const wordPrompt = document.getElementById('wordPrompt');
  const lettersDiv = document.getElementById('letters');
  const answerDiv = document.getElementById('answer');
  const resultEl = document.getElementById('result');
  const wordAudio = document.getElementById('wordAudio');
  const scoreEl = document.getElementById('score');
  const checkBtn = document.getElementById('checkBtn');

  function loadWord() {
    const current = words[currentIndex];
    wordPrompt.textContent = `Spell the word: "${current.word}"`;
    wordAudio.src = current.audio;

    // Clear letters and answer areas
    lettersDiv.innerHTML = '';
    answerDiv.innerHTML = '';
    resultEl.textContent = '';
    answeredCorrectly = false;
    checkBtn.disabled = false;

    // Shuffle letters so user can't guess order
    const shuffledLetters = shuffleArray([...current.letters]);
    shuffledLetters.forEach((letter, i) => {
      const letterDiv = document.createElement('div');
      letterDiv.textContent = letter;
      letterDiv.className = 'letter';
      letterDiv.setAttribute('draggable', 'true');
      letterDiv.id = `letter${i}`;
      letterDiv.addEventListener('dragstart', dragStart);
      lettersDiv.appendChild(letterDiv);
    });

    updateScore();
  }

  function shuffleArray(array) {
    for(let i = array.length -1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i+1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // Drag & Drop Handlers
  let dragged = null;

  function dragStart(e) {
    dragged = e.target;
  }

  function allowDrop(e) {
    e.preventDefault();
  }

  function drop(e) {
    e.preventDefault();
    if(dragged) {
      // Prevent dropping on letter div itself
      if(e.target.classList.contains('letter')) return;

      // Append dragged letter to answer or back to letters
      if(e.target.id === 'answer' || e.target.id === 'letters') {
        e.target.appendChild(dragged);
      } else {
        e.target.parentNode.appendChild(dragged);
      }
      dragged = null;
    }
  }

  function checkSpelling() {
    if (answeredCorrectly) return; // prevent multiple scoring for same word

    let spelledWord = '';
    answerDiv.childNodes.forEach(node => {
      spelledWord += node.textContent.trim();
    });

    // Normalize to NFC Unicode form for accurate Telugu matching
    const normalizeText = (text) => text.normalize('NFC').trim();
    const userAnswer = normalizeText(spelledWord);
    const correctAnswer = normalizeText(words[currentIndex].word);

    if (userAnswer === correctAnswer) {
      resultEl.textContent = '‚úÖ Correct!';
      score++;
      updateScore();
      answeredCorrectly = true;
      checkBtn.disabled = true;
    } else {
      resultEl.textContent = '‚ùå Incorrect, try again!';
    }
  }

  function resetGame() {
    // Move all letters back to lettersDiv
    while(answerDiv.firstChild) {
      lettersDiv.appendChild(answerDiv.firstChild);
    }
    resultEl.textContent = '';
    answeredCorrectly = false;
    checkBtn.disabled = false;
  }

  function nextWord() {
    if(currentIndex < words.length - 1) {
      currentIndex++;
      resetGame();
      loadWord();
    }
  }

  function prevWord() {
    if(currentIndex > 0) {
      currentIndex--;
      resetGame();
      loadWord();
    }
  }

  function updateScore() {
    scoreEl.textContent = `Score: ${score} / ${words.length}`;
  }

  function playAudio() {
    wordAudio.play();
  }

  // Initialize game on page load
  loadWord();
</script>

</body>
</html>
